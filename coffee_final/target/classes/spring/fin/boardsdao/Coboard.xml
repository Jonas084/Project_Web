<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.fin.boardsmodel.CoBoardDTO">
	<!-- 게시판 목록 보기(JDBC) -> myBatis 변경 -->
	
	<select id="coboard_list" parameterType="java.util.Map" resultType="coboard">
		select * from (select CoBoard.*, rownum as rnum
								from (select * from CoBoard where coboard_level = 0 order by
								coboard_ref desc, coboard_step asc )
								CoBoard) where rnum<![CDATA[>=]]>#{startrow}
								and rnum<![CDATA[<=]]>#{endrow}
	
	</select>
	<!-- 조회수 증가 -->
	<update id="coboard_hit" parameterType="int" >
      update CoBoard set coboard_hit=coboard_hit+1
      where coboard_no=#{coboard_no}
	</update>
   <!-- 게시판 내용 보기 -->
   <select id="coboard_cont" parameterType="int"
           resultType="coboard">
    select * from CoBoard where coboard_no=#{coboard_no}      
   </select>
   <!-- 게시물 수정 -->
   <update id="coboard_edit" parameterType="coboard">
     update CoBoard set 
     coboard_title=#{coboard_title}, coboard_cont=#{coboard_cont}
     where coboard_no=#{coboard_no}     
   </update>

   <insert id="coboard_insert" parameterType="coboard">
     insert into CoBoard
       values(CoBoard_seq.nextval,#{coboard_sort},#{coboard_title},
       #{coboard_cont}, #{coboard_name}, #{coboard_pwd},0,
       CoBoard_seq2.nextval,0,0,sysdate,0,0)   
   </insert>

   <!--게시물 총 개수 (iBatis) -> myBatis변경 -->   
   <select id="coboard_count" resultType="int">
      select count(coboard_no) from CoBoard where coboard_level = 0
   </select>
   
   <!--게시물 삭제 (iBatis) -> myBatis변경 -->
   <delete id="coboard_del" parameterType="int">
     delete from CoBoard where coboard_no=#{coboard_no}
   </delete>
   
   <!-- 답변 달기(JDBC) -> myBatis변경 -->
	<update id="coboard_replUp" parameterType="java.util.Map">
		update CoBoard set coboard_step=coboard_step+1
		where coboard_ref=#{coboard_ref} and coboard_step<![CDATA[ > ]]>#{coboard_step}	
	</update>
      
    <insert id="coboard_replIn" parameterType="coboard">
    	insert into CoBoard
    	values(CoBoard_seq.nextval, #{coboard_sort} ,#{coboard_title},  #{coboard_cont},  #{coboard_name},
    	1234, #{coboard_hit}, #{coboard_ref}, #{coboard_step} ,#{coboard_level},  sysdate,0,0)  
    </insert>
    
    <!-- 답변 내용들 목록으로 불러오기 -->
	<select id="coboard_recont" parameterType="int" resultType="coboard">
		select * from CoBoard where coboard_ref = #{coboard_ref} 
		order by coboard_step desc
	</select>
      
     <!-- 게시판 검색결과(제목) 총 게시물 수 -->
     <select id="coboardfind_cnt1" parameterType="String" resultType="int">
     	select count(coboard_no) from CoBoard
     	where coboard_sort like #{find_name}
     </select>
     
      <select id="coboardfind_cnt2" parameterType="String" resultType="int">
     	select count(coboard_no) from CoBoard
     	where coboard_title like #{find_name}
     </select>
     
      <select id="coboardfind_cnt3" parameterType="String" resultType="int">
     	select count(coboard_no) from CoBoard
     	where coboard_name like #{find_name}
     </select>
     
     <select id="coboardfind_cnt4" parameterType="String" resultType="int">
     	select count(coboard_no) from CoBoard
     	where coboard_cont like #{find_name}
     </select>
     
     
     <!-- 게시판 검색 목록 보기-->
     <select id="cobFinList1" parameterType="java.util.Map" resultType="coboard">
    <!--  select * from CoBoard -->
     select * from (select rownum as rnum, coboard_no, coboard_sort, coboard_name,
     	coboard_title, coboard_cont, coboard_ref, coboard_step, coboard_level, coboard_hit,
     	coboard_regdate, coboard_recommendation, coboard_opposition from
     	(select * from CoBoard where coboard_level = 0 order by coboard_ref desc, coboard_step asc) 
     	 where coboard_sort like #{find_name} and rownum <![CDATA[<=]]> #{pagelimit1})
     	 where rnum <![CDATA[>=]]> #{pagelimit2}
     </select>	 
     
      <select id="cobFinList2" parameterType="java.util.Map" resultType="coboard">
     select * from (select rownum as rnum, coboard_no, coboard_sort, coboard_name,
     	coboard_title, coboard_cont, coboard_ref, coboard_step, coboard_level, coboard_hit,
     	coboard_regdate, coboard_recommendation, coboard_opposition from
     	(select * from CoBoard where coboard_level = 0 order by coboard_ref desc, coboard_step asc) 
     	 where coboard_title like #{find_name} and rownum <![CDATA[<=]]> #{pagelimit1})
     	 where rnum <![CDATA[>=]]> #{pagelimit2}
     </select>
     
       <select id="cobFinList3" parameterType="java.util.Map" resultType="coboard">
     select * from (select rownum as rnum, coboard_no, coboard_sort, coboard_name,
     	coboard_title, coboard_cont, coboard_ref, coboard_step, coboard_level, coboard_hit,
     	coboard_regdate, coboard_recommendation, coboard_opposition from
     	(select * from CoBoard where coboard_level = 0 order by coboard_ref desc, coboard_step asc) 
     	 where coboard_name like #{find_name} and rownum <![CDATA[<=]]> #{pagelimit1})
     	 where rnum <![CDATA[>=]]> #{pagelimit2}
     </select>
     
       <select id="cobFinList4" parameterType="java.util.Map" resultType="coboard">
     select * from (select rownum as rnum, coboard_no, coboard_sort, coboard_name,
     	coboard_title, coboard_cont, coboard_ref, coboard_step, coboard_level, coboard_hit,
     	coboard_regdate, coboard_recommendation, coboard_opposition from
     	(select * from CoBoard where coboard_level = 0 order by coboard_ref desc, coboard_step asc) 
     	 where coboard_cont like #{find_name} and rownum <![CDATA[<=]]> #{pagelimit1})
     	 where rnum <![CDATA[>=]]> #{pagelimit2}
     </select>     

     
     <!-- 추천수 증가 -->
	<update id="coboard_recommendation" parameterType="int" >
      update CoBoard set coboard_recommendation=coboard_recommendation+1
      where coboard_no=#{coboard_no}
	</update>
     
      <!-- 비추천수 증가 -->
	<update id="coboard_opposition" parameterType="int" >
      update CoBoard set coboard_opposition=coboard_opposition+1
      where coboard_no=#{coboard_no}
	</update>
     
     <!-- 최다 조회글 -->
	<select id="best_click" resultType="coboard">
		select * from CoBoard where coboard_hit = (select max(coboard_hit) from CoBoard) order by coboard_regdate
	</select>    
     
     <!-- 최다 추천글 -->
	<select id="best_reco" resultType="coboard">
		select * from CoBoard where coboard_recommendation = (select max(coboard_recommendation) from CoBoard) order by coboard_regdate 
	</select>    
     
     
     
</mapper>